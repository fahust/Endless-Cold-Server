const{workerData:workerData,parentPort:parentPort}=require("worker_threads");function getDistanceFromLatLonInKm(e,r,o,a){var t=deg2rad(o-e),r=deg2rad(a-r),r=Math.sin(t/2)*Math.sin(t/2)+Math.cos(deg2rad(e))*Math.cos(deg2rad(o))*Math.sin(r/2)*Math.sin(r/2);return 6371*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))}function deg2rad(e){return e*(Math.PI/180)}function getRandomInt(e,r){return e=Math.ceil(e),r=Math.floor(r),Math.floor(Math.random()*(r-e))+e}function getRandomArbitrary(e,r){return Math.random()*(r-e)+e}function blacksmith(r,e){var o,a,t;1<=r.place.armory.build&&(o=getRandomInt(5*r.place.armory.build,10*r.place.armory.build),a=!1,Object.keys(r.cloth).length<5*r.place.store.build?a=!0:(t=void 0,Object.keys(r.cloth).forEach(e=>{(!t||t.value>r.cloth[e].value)&&(t=r.cloth[e])}),t&&t.value<o?(a=!0,delete r.cloth[t]):a=!1),1==a&&(1==getRandomInt(0,1e3)?r.cloth[getRandomInt(0,1e5)]={name:"Pistol",type:"arme",value:100<o?100:o,poids:.5,equiped:0,label:"Damage",repair:["Screw","Toolbox","Metal","Gear"],need:"9 mm",icon:"pistol",durability:100}:1==getRandomInt(0,1e3)?r.cloth[getRandomInt(0,1e5)]={name:"Shootgun",type:"arme",value:100<o?100:o,poids:getRandomInt(3,4),equiped:0,label:"Damage",repair:["Screw","Toolbox","Metal","Gear"],need:"12 mm",icon:"gun1",durability:100}:1==getRandomInt(0,1e3)?r.cloth[getRandomInt(0,1e5)]={name:"Ak47",type:"arme",value:100<o?100:o,poids:getRandomInt(3,4),equiped:0,label:"Damage",repair:["Screw","Toolbox","Metal","Gear"],need:"7,62 mm",icon:"gun2",durability:100}:1==getRandomInt(0,1e3)?r.cloth[getRandomInt(0,1e5)]={name:"Rifle",type:"arme",value:100<o?100:o,poids:getRandomInt(4,5),equiped:0,label:"Damage",repair:["Screw","Toolbox","Metal","Gear"],need:"12 mm",icon:"gun3",durability:100}:1==getRandomInt(0,1e3)&&(r.cloth[getRandomInt(0,1e5)]={name:"Sniper",type:"arme",value:100<o?100:o,poids:getRandomInt(5,6),equiped:0,label:"Damage",repair:["Screw","Toolbox","Metal","Gear"],need:"5,56 mm",icon:"gun4",durability:100}),objSendable.cloth=r.cloth))}var randomProperty=function(e){var r=Object.keys(e);return e[r[r.length*Math.random()<<0]]};function armorsmith(r,e){var o,a,t;1<=r.place.weaving.build&&(o=getRandomInt(5*r.place.weaving.build,10*r.place.weaving.build),a=!1,Object.keys(r.cloth).length<5*r.place.store.build?a=!0:(t=void 0,Object.keys(r.cloth).forEach(e=>{(!t||t.value>r.cloth[e].value)&&(t=r.cloth[e])}),t&&t.value<o?(a=!0,delete r.cloth[t]):a=!1),1==a&&(1==getRandomInt(0,100)?r.cloth[getRandomInt(0,1e5)]={name:"Hat",type:"vêtements",value:100<o?100:o,poids:.5,equiped:0,label:"Protection",repair:["Cloth","Skin"],icon:"hat-fedora",durability:100}:1==getRandomInt(0,100)?r.cloth[getRandomInt(0,1e5)]={name:"Tshirt",type:"vêtements",value:100<o?100:o,poids:getRandomInt(1,3),equiped:0,label:"Protection",repair:["Cloth","Skin"],icon:"tshirt-v-outline",durability:100}:1==getRandomInt(0,100)?r.cloth[getRandomInt(0,1e5)]={name:"Sweat",type:"vêtements",value:100<o?100:o,poids:.5,equiped:0,label:"Protection",repair:["Cloth","Skin"],icon:"tshirt-crew",durability:100}:1==getRandomInt(0,100)?r.cloth[getRandomInt(0,1e5)]={name:"Gloves",type:"vêtements",value:100<o?100:o,poids:.5,equiped:0,label:"Protection",repair:["Cloth","Skin"],icon:"mixed-martial-arts",durability:100}:1==getRandomInt(0,100)?r.cloth[getRandomInt(0,1e5)]={name:"Pants",type:"vêtements",value:100<o?100:o,poids:getRandomInt(2,3),equiped:0,label:"Protection",repair:["Cloth","Skin"],icon:"gentoo",durability:100}:1==getRandomInt(0,100)&&(r.cloth[getRandomInt(0,1e5)]={name:"Shooes",type:"vêtements",value:100<o?100:o,poids:getRandomInt(1,3),equiped:0,label:"Protection",repair:["Cloth","Skin"],icon:"shoe-formal",durability:100}),objSendable.cloth=r.cloth))}function deleteQueue(o,a){var t=!0;o.queue.forEach((e,r)=>{e==a&&1==t&&(o.queue.splice(r,1),t=!1)})}function instructor(e,r){e=randomProperty(e.refugee);e.job.f<100&&(e.job.f+=.1)}function builder(r,o){var a;r.queue[0]&&0<r.queue.length&&(a=!0,Object.keys(houseNeed[r.queue[0]]).forEach(e=>{r.ress[e]<Math.floor(houseNeed[r.queue[0]][e]*(1+r.place[r.queue[0]].build)*(.1*Math.round(r.law.workHourByDay*(1+r.refugee[o].job.b/1e3))/(1+r.place[r.queue[0]].build)))&&(a=!1)}),1==a&&(Object.keys(houseNeed[r.queue[0]]).forEach(e=>{r.ress[e]>=houseNeed[r.queue[0]][e]*(1+r.place[r.queue[0]].build)&&(r.ress[e]-=Math.floor(houseNeed[r.queue[0]][e]*(1+r.place[r.queue[0]].build)*(.1*Math.round(r.law.workHourByDay*(1+r.refugee[o].job.b/1e3))/(1+r.place[r.queue[0]].build)))),r.prod[e].use+=Math.floor(houseNeed[r.queue[0]][e]*(1+r.place[r.queue[0]].build)*(.1*Math.round(r.law.workHourByDay*(1+r.refugee[o].job.b/1e3))/(1+r.place[r.queue[0]].build)))}),r.place[r.queue[0]].progress+=.1*Math.round(r.law.workHourByDay*(1+r.refugee[o].job.b/1e3))/(1+r.place[r.queue[0]].build),r.place[r.queue[0]].progress=Math.round(1e4*r.place[r.queue[0]].progress)/1e4,100<r.place[r.queue[0]].progress&&(r.place[r.queue[0]].build+=1,r.place[r.queue[0]].progress=0,r.queue.shift())))}function farmer(r,o){var a=!0,t=!0;r.rGreve=1,r.greve<=0?r.greve=1:500<r.greve&&(r.rGreve=10),1e3<r.greve&&(r.greve=1e3),farming[r.refugee[o].work].need.forEach(e=>{r.ress[e]<Math.round(10*r.law.workHourByDay*(farming[r.refugee[o].work].bonusPlace?1+r.place[farming[r.refugee[o].work].bonusPlace].build/10:1)*(1+r.refugee[o].job.h/1e3)*(1+r.place.factory.build/20)/r.rGreve/ressProd[e])&&(a=!1)}),1==a&&(farming[r.refugee[o].work].value.forEach(e=>{r.ress[e]<5e3*(1+r.place.store.build*r.place.store.build)/ressProd[e]&&(t=!1)}),0==t&&(farming[r.refugee[o].work].need.forEach(e=>{r.ress[e]-=Math.round(10*r.law.workHourByDay*(farming[r.refugee[o].work].bonusPlace?1+r.place[farming[r.refugee[o].work].bonusPlace].build/10:1)*(1+r.refugee[o].job.h/1e3)*(1+r.place.factory.build/20)/r.rGreve/ressProd[e]),r.prod[e].use+=Math.round(10*r.law.workHourByDay*(farming[r.refugee[o].work].bonusPlace?1+r.place[farming[r.refugee[o].work].bonusPlace].build/10:1)*(1+r.refugee[o].job.h/1e3)*(1+r.place.factory.build/20)/r.rGreve/ressProd[e])}),farming[r.refugee[o].work].value.forEach(e=>{r.ress[e]<5e3*(1+r.place.store.build*r.place.store.build)/ressProd[e]&&(r.ress[e]+=Math.round(10*r.law.workHourByDay*(farming[r.refugee[o].work].bonusPlace?1+r.place[farming[r.refugee[o].work].bonusPlace].build/10:1)*(1+r.refugee[o].job.h/1e3)*(1+r.place.factory.build/20)/r.rGreve/ressProd[e]),r.ress[e]>5e3*(1+r.place.store.build*r.place.store.build)/ressProd[e]&&(r.ress[e]=5e3*(1+r.place.store.build*r.place.store.build)/ressProd[e])),r.prod[e]&&(r.prod[e].prod+=Math.round(10*r.law.workHourByDay*(farming[r.refugee[o].work].bonusPlace?1+r.place[farming[r.refugee[o].work].bonusPlace].build/10:1)*(1+r.refugee[o].job.h/1e3)*(1+r.place.factory.build/20)/r.rGreve/ressProd[e]))})))}function hapiness(e,r){e.refugee[r].h=0,e.refugee[r].h-=e.law.workHourByDay/(1+e.psycho),e.refugee[r].h-=(18-e.law.ageForReproduce)/(1+e.psycho),e.refugee[r].h+=e.law.ageForWork*(1+e.psycho),e.refugee[r].h+=2*e.law.foodByDay*(1+e.psycho),e.refugee[r].h+=2*e.law.woodByDay*(1+e.psycho),e.refugee[r].h+=2*e.law.waterByDay*(1+e.psycho),e.refugee[r].h+=(1+e.place.school.build/20)*(1+e.psycho),e.refugee[r].h+=(1+e.place.medical.build/20)*(1+e.psycho),e.refugee[r].h+=(1+e.place.church.build/20)*(1+e.psycho),e.refugee[r].h+=(1+e.place.bar.build/10)*(1+e.psycho),e.refugee[r].h+=(e.refugee[r].job.h/25+e.refugee[r].job.m/25+e.refugee[r].job.t/25+e.refugee[r].job.p/25+e.refugee[r].job.b/25)*(1+e.psycho),100<e.refugee[r].h?e.refugee[r].h=100:e.refugee[r].h<0?e.refugee[r].h=0:e.refugee[r].h=Math.floor(e.refugee[r].h),e.refugee[r].h<50?e.greve+=(50-e.refugee[r].h)/1e4:e.greve-=e.refugee[r].h/1e4,e.greve=Math.floor(1e3*e.greve)/1e3}var sendNotification=function(e){var r={host:"onesignal.com",port:443,path:"/api/v1/notifications",method:"POST",headers:{"Content-Type":"application/json; charset=utf-8",Authorization:"Basic NjQ4MTdjZjQtMTNkNS00MjM2LWE2N2YtYjg3M2E2MTU0NzQ2"}},r=require("https").request(r,function(e){e.on("data",function(e){})});r.on("error",function(e){console.log("ERROR:"),console.log(e)}),r.write(JSON.stringify(e)),r.end()},message={app_id:"5dc2b6c6-0a28-483b-b7a4-10cdeb9b2489",contents:{en:"Server Restarted"},included_segments:["All"]};function houseProcess(t){Date.now();t.prod={wood:{prod:0,use:0},food:{prod:0,use:0},water:{prod:0,use:0},ammo:{prod:0,use:0},stone:{prod:0,use:0},boards:{prod:0,use:0},bricks:{prod:0,use:0},leather:{prod:0,use:0},armor:{prod:0,use:0},copper:{prod:0,use:0},metal:{prod:0,use:0},gold:{prod:0,use:0},gear:{prod:0,use:0},screw:{prod:0,use:0},toolbox:{prod:0,use:0},gunpowder:{prod:0,use:0}};var r,e,o,a,u,l,s,n,g,d=[],i=[],f=0,c=0,b=0,h=0,p=0,m=0,y=0;if(Object.keys(t.refugee).forEach(e=>{var r,o,a;t.refugee[e].a>=t.law.ageForWork&&t.refugee[e].a<70?(m+=1,t.refugee[e].job.h=Math.round(t.refugee[e].job.h),t.refugee[e].job.m=Math.round(t.refugee[e].job.m),t.refugee[e].job.t=Math.round(t.refugee[e].job.t),t.refugee[e].job.p=Math.round(t.refugee[e].job.p),t.refugee[e].job.b=Math.round(t.refugee[e].job.b),t.ress.wood<6*Object.keys(t.refugee).length&&(t.refugee[e].work="lumberjack"),t.ress.food<3*Object.keys(t.refugee).length&&(t.refugee[e].work="farmer"),"farmer"==t.refugee[e].work||"leatherworker"==t.refugee[e].work||"stonemason"==t.refugee[e].work||"woodworker"==t.refugee[e].work||"lumberjack"==t.refugee[e].work||"hunter"==t.refugee[e].work||"stone miner"==t.refugee[e].work||"ammo technician"==t.refugee[e].work||"craftsman"==t.refugee[e].work||"metalworker"==t.refugee[e].work?farmer(t,e):"weapon technician"==t.refugee[e].work?blacksmith(t,e):"armor technician"==t.refugee[e].work?armorsmith(t,e):"builder"==t.refugee[e].work?builder(t,e):"instructor"==t.refugee[e].work&&instructor(t,e),t.ress.water<5e3*(1+t.place.store.build*t.place.store.build)&&(t.ress.water+=Math.round(t.law.workHourByDay*(1+t.refugee[e].job.h/1e3)*(1+t.place["water station"].build/10))),t.ress.water>5e3*(1+t.place.store.build*t.place.store.build)&&(t.ress.water=5e3*(1+t.place.store.build*t.place.store.build)),t.prod.water&&(t.prod.water.prod+=Math.round(t.law.workHourByDay*(1+t.refugee[e].job.h/1e3)*(1+t.place["water station"].build/10))),f+=t.refugee[e].job.t,c+=t.refugee[e].job.b,b+=t.refugee[e].job.m,h+=t.refugee[e].job.p):t.refugee[e].a<t.law.ageForWork&&1<=t.place.school.build&&(t.refugee[e].job.h<100&&(t.refugee[e].job.h+=getRandomArbitrary(0,0==t.refugee[e].s?.02:.04)*(1+t.teacher)*(1+t.place.school.build/20)),t.refugee[e].job.m<100&&(t.refugee[e].job.m+=getRandomArbitrary(0,.04)*(1+t.teacher)*(1+t.place.school.build/20)),t.refugee[e].job.t<100&&(t.refugee[e].job.t+=getRandomArbitrary(0,0==t.refugee[e].s?.04:.02)*(1+t.teacher)*(1+t.place.school.build/20)),t.refugee[e].job.p<100&&(t.refugee[e].job.p+=getRandomArbitrary(0,0==t.refugee[e].s?.04:.02)*(1+t.teacher)*(1+t.place.school.build/20)),t.refugee[e].job.b<100&&(t.refugee[e].job.b+=getRandomArbitrary(0,0==t.refugee[e].s?.02:.04)*(1+t.teacher)*(1+t.place.school.build/20))),hapiness(t,e),getRandomArbitrary(0,Object.keys(houses).length)<getRandomArbitrary(0,1)&&18<t.refugee[e].a&&t.refugee[e].a<70&&(Object.keys(t.refugee).length>2*(2+t.place.house.build)-2||t.refugee[e].h<50||t.refugee[e].l<50||getRandomArbitrary(0,10)>getRandomArbitrary(0,100))&&!exportMessage.moveRefugee&&1==getRandomInt(0,Object.keys(houses).length)&&4<=m?(r=[],Object.keys(houses).forEach(e=>{getDistanceFromLatLonInKm(houses[e].lat,houses[e].lng,t.lat,t.lng)<200&&t.id!=houses[e].id&&Object.keys(houses[e].refugee).length<2*(2+houses[e].place.house.build)-2&&2<houses[e].birth&&r.push(houses[e])}),0<r.length&&(houseNear=r[getRandomInt(0,r.length)],houseNear.refugee[e]=Object.assign({},t.refugee[e],{}),delete t.refugee[e],o=getDistanceFromLatLonInKm(t.lat,t.lng,houseNear.lat,houseNear.lng),exportMessage.moveRefugee={houseNear:{id:houseNear.id,refugee:houseNear.refugee[e]},sLat:t.lat,slng:t.lng,eLat:houseNear.lat,eLng:houseNear.lng,dist:o,byId:t.id,toId:houseNear.id,houseNear:houseNear})):(getRandomArbitrary(0,4e3)<getRandomArbitrary(0,1+20*t.malade)&&3<Object.keys(t.refugee[e])&&(t[Object.keys(t.log).length]={t:"Disease",c1:t.refugee[e].n,d:Date.now()},t.refugee[e].v+=1,objSendable.log=t.log),0<t.refugee[e].v&&3<Object.keys(t.refugee[e])&&(t.refugee[e].l-=.1,t.refugee[e].v-=.1+t.place.medical.build/100*(1+t.medic),p+=1),t.freeze+=getRandomInt(5,-5),0<t.freeze?t.freeze=0:t.freeze<-50&&(t.freeze=-50),t.refugee[e]&&(0==t.refugee[e].s&&0<t.refugee[e].e&&(y+=1,--t.refugee[e].e,t.refugee[e].e<=0&&(a=names[getRandomInt(0,names.length)].name,t.log[Object.keys(t.log).length]={t:"Birth",c1:t.refugee[e].n.name,c2:t.refugee[e].lf,c3:a.name,d:Date.now()},t.refugee[t.birth]={s:getRandomInt(0,2),a:1,l:100,e:-1,ap:1,h:100,v:0,job:{h:1,m:1,t:1,p:1,b:1,f:1},n:a,m:t.refugee[e].n,f:t.refugee[e].lf,lf:"",work:"farmer",p:getRandomInt(1,41)},t.refugee[e].e=-1,t.birth+=1,a={app_id:"5dc2b6c6-0a28-483b-b7a4-10cdeb9b2489",headings:{en:"Refuge",fr:"Refuge"},contents:{en:"A baby was born in your refuge.",fr:"A baby was born in your refuge."},filters:[{field:"tag",key:"id",relation:"=",value:t.proprio},{operator:"AND"},{field:"tag",key:"myRefuge",relation:"=",value:"true"}]},sendNotification(a),objSendable.log=t.log)),1==t.refugee[e].s&&t.refugee[e].a>t.law.ageForReproduce&&d.push(t.refugee[e]),0==t.refugee[e].s&&t.refugee[e].a>t.law.ageForReproduce&&t.refugee[e].a<50&&t.refugee[e].e<0&&i.push(t.refugee[e]),t.refugee[e].ap<1095?t.refugee[e].ap+=1:(t.refugee[e].ap=1,t.refugee[e].a+=1),0<t.ress.wood?(t.ress.wood-=t.refugee[e].a<t.law.ageForWork?1:t.law.woodByDay,t.prod.wood.use+=t.refugee[e].a<t.law.ageForWork?1:t.law.woodByDay,t.refugee[e].l<=100?t.refugee[e].l-=t.refugee[e].a>=t.law.ageForWork?Math.floor(Math.abs(t.freeze)/10-t.law.woodByDay+(1+t.medic)):0:t.refugee[e].l=99):(t.ress.wood=0)<t.refugee[e].l&&(t.refugee[e].l-=getRandomInt(1,Math.abs(t.freeze))),0<t.ress.food?(t.ress.food-=t.refugee[e].a<t.law.ageForWork?1:t.law.foodByDay,t.prod.food.use+=t.refugee[e].a<t.law.ageForWork?1:t.law.foodByDay,t.refugee[e].l<=100?t.refugee[e].l-=t.refugee[e].a>=t.law.ageForWork?Math.floor(2-t.law.foodByDay+(1+t.medic)):0:t.refugee[e].l=99):(t.ress.food=0)<t.refugee[e].l&&(t.refugee[e].l-=getRandomInt(1,3)),0<t.ress.water?(t.ress.water-=t.refugee[e].a<t.law.ageForWork?1:t.law.waterByDay,t.prod.water.use+=t.refugee[e].a<t.law.ageForWork?1:t.law.waterByDay,t.refugee[e].l<=100?t.refugee[e].l-=t.refugee[e].a>=t.law.ageForWork?Math.floor(3-t.law.waterByDay+(1+t.medic)):0:t.refugee[e].l=99):(t.ress.water=0)<t.refugee[e].l&&(t.refugee[e].l-=getRandomInt(1,3)),(70<t.refugee[e].a||t.refugee[e].l<=1)&&(70<t.refugee[e].a?1==getRandomInt(0,5e3)&&(t.log[Object.keys(t.log).length]={t:"Death of old age",c1:t.refugee[e].n,c2:t.refugee[e].a,d:Date.now()},delete t.refugee[e],a={app_id:"5dc2b6c6-0a28-483b-b7a4-10cdeb9b2489",headings:{en:"Refuge",fr:"Refuge"},contents:{en:"A refugee is death of old age in your refuge.",fr:"A refugee is death of old age in your refuge."},filters:[{field:"tag",key:"id",relation:"=",value:t.proprio},{operator:"AND"},{field:"tag",key:"myRefuge",relation:"=",value:"true"}]},sendNotification(a),objSendable.log=t.log):(t.log[Object.keys(t.log).length]={t:"Death",c1:t.refugee[e].n,c2:t.refugee[e].a,d:Date.now()},delete t.refugee[e],a={app_id:"5dc2b6c6-0a28-483b-b7a4-10cdeb9b2489",headings:{en:"Refuge",fr:"Refuge"},contents:{en:"A refugee died from a lack of resources in your refuge.",fr:"A refugee died from a lack of resources in your refuge."},filters:[{field:"tag",key:"id",relation:"=",value:t.proprio},{operator:"AND"},{field:"tag",key:"myRefuge",relation:"=",value:"true"}]},sendNotification(a),objSendable.log=t.log))))}),getRandomArbitrary(0,15e4)<getRandomArbitrary(0,1)&&5<Object.keys(t.refugee).length){var w={},k=0;for(let e=0;e<Object.keys(t.refugee).length+getRandomInt(1,6);e++)w[++k]={id:k,life:100,dmg:getRandomInt(2,22),p:getRandomInt(1,11),s:getRandomInt(0,2),n:names[getRandomInt(0,names.length)].name};t.fortress={enemy:w,allie:{}},exportMessage.newFortress={f:1,lat:t.lat,lng:t.lng,id:t.id},Object.keys(listPlayers).forEach(e=>{getDistanceFromLatLonInKm(listPlayers[e].lat,listPlayers[e].lng,t.lat,t.lng)<100&&sendNotification({app_id:"5dc2b6c6-0a28-483b-b7a4-10cdeb9b2489",headings:{en:"Refuge",fr:"Refuge"},contents:{en:"A close refuge is raided by enemies",fr:"Refuge"},filters:[{field:"tag",key:"id",relation:"=",value:e},{operator:"AND"},{field:"tag",key:"raid",relation:"=",value:"true"}]})}),objSendable.fortress=t.fortress}getRandomArbitrary(0,5e3)<getRandomArbitrary(0,1)&&5<t.birth?(l=getRandomArbitrary(r=0,101*Object.keys(t.refugee).length),Object.keys(t.refugee).forEach(e=>{r+=t.refugee[e].job.f}),r<l&&0<Object.keys(t.refugee).length?(o=randomProperty(t.refugee),t.place.school.progress-=getRandomInt(5,75),t.place.school.progress<0&&(t.place.school.progress=0),t.place.medical.progress-=getRandomInt(5,75),t.place.medical.progress<0&&(t.place.medical.progress=0),t.place.church.progress-=getRandomInt(5,75),t.place.church.progress<0&&(t.place.church.progress=0),t.place.bar.progress-=getRandomInt(5,75),t.place.bar.progress<0&&(t.place.bar.progress=0),t.place.store.progress-=getRandomInt(5,75),t.place.store.progress<0&&(t.place.store.progress=0),t.place.workshop.progress-=getRandomInt(5,75),t.place.workshop.progress<0&&(t.place.workshop.progress=0),t.log[Object.keys(t.log).length]={t:"The refuge caught fire",c1:o.n,c2:o.a,d:Date.now()},delete o,s={app_id:"5dc2b6c6-0a28-483b-b7a4-10cdeb9b2489",headings:{en:"Refuge",fr:"Refuge"},contents:{en:"Your buildings were damaged and a refugee died in the flames.",fr:"Your buildings were damaged and a refugee died in the flames."},filters:[{field:"tag",key:"id",relation:"=",value:t.proprio},{operator:"AND"},{field:"tag",key:"myRefuge",relation:"=",value:"true"}]},sendNotification(s)):Object.keys(t.refugee).length<=0?(n=void 0,Object.keys(t.place).forEach(e=>{0<t.place[e].build&&!n&&(--t.place[e].build,n=e)}),n||(destroyHouse=1),t.log[Object.keys(t.log).length]={t:"The refuge fall in ruins",d:Date.now()}):t.log[Object.keys(t.log).length]={t:"The fire but it's under control",d:Date.now()},objSendable.log=t.log):getRandomArbitrary(0,3e3)<getRandomArbitrary(0,1)&&5<t.birth&&(l=getRandomArbitrary(r=0,101*Object.keys(t.refugee).length),Object.keys(t.refugee).forEach(e=>{r+=t.refugee[e].job.f}),e=getRandomInt(50,150),t.ress.ammo>=e&&(r+=getRandomInt(50,150),t.ress.ammo-=e),r<l&&0<Object.keys(t.refugee).length?(o=randomProperty(t.refugee),a=getRandomInt(50,150),u=getRandomInt(50,150),l=getRandomInt(50,150),t.ress.wood-=a,t.ress.wood<0&&(t.ress.wood=0),t.ress.food-=u,t.ress.food<0&&(t.ress.food=0),t.ress.water-=l,t.ress.water<0&&(t.ress.water=0),t.ress.ammo-=e,t.ress.ammo<0&&(t.ress.ammo=0),t.log[Object.keys(t.log).length]={t:"The refuge was attacked by robbers",c1:o.n,c2:o.a,c3:a,c4:u,c5:l,c6:e,d:Date.now()},delete o,s={app_id:"5dc2b6c6-0a28-483b-b7a4-10cdeb9b2489",headings:{en:"Refuge",fr:"Refuge"},contents:{en:"The refuge was attacked by robbers and a refugee died in the fight.",fr:"The refuge was attacked by robbers and a refugee died in the fight."},filters:[{field:"tag",key:"id",relation:"=",value:t.proprio},{operator:"AND"},{field:"tag",key:"myRefuge",relation:"=",value:"true"}]},sendNotification(s)):Object.keys(t.refugee).length<=0?(n=void 0,Object.keys(t.place).forEach(e=>{0<t.place[e].build&&!n&&(--t.place[e].build,n=e)}),n||(destroyHouse=1),t.log[Object.keys(t.log).length]={t:"The refuge fall in ruins",d:Date.now()}):t.log[Object.keys(t.log).length]={t:"The refuge was defended",c6:e,d:Date.now()},objSendable.log=t.log),t.teacher=f/1e4,t.build=c/1e4,t.medic=b/1e4,t.psycho=h/1e4,t.malade=p,0<d.length&&0<i.length&&Object.keys(t.refugee).length+y<2*(2+t.place.house.build)&&(g=2*(2+t.place.house.build)-(Object.keys(t.refugee).length+y),i.forEach(e=>{1==getRandomInt(0,500)&&0<g&&(e.e=270,e.lf=d[getRandomInt(0,d.length)].n,g--)})),50<Object.keys(t.log).length&&delete t.log[Object.keys(t.log).shift()],listPlayers[t.proprio]?Date.now()>listPlayers[t.proprio].lastCo+2592e6&&(t.proprio=-1,exportMessage.newFortress={f:1,lat:t.lat,lng:t.lng,id:t.id}):-1!=t.proprio?(t.proprio=-1,exportMessage.newFortress={f:1,lat:t.lat,lng:t.lng,id:t.id}):Date.now()>t.la+5184e6&&(destroyHouse=1),objSendable.queue=t.queue,objSendable.refugee=t.refugee,objSendable.ress=t.ress,objSendable.prod=t.prod,objSendable.place=t.place,objSendable.greve=t.greve,objSendable.rGreve=t.rGreve,parentPort.postMessage({house:t,id:t.id,exportMessage:exportMessage,listPlayers:listPlayers,objSendable:objSendable,destroyHouse:destroyHouse})}houses=workerData.houses,names=workerData.names,listPlayers=workerData.listPlayers,farming=workerData.farming,jobList=workerData.jobList,houseNeed=workerData.houseNeed,ressProd=workerData.ressProd;var destroyHouse=0,objSendable={};exportMessage={newFortress:void 0,moveRefugee:void 0},houseProcess(workerData.house);